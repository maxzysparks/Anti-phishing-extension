let phishTankDB=null;async function loadDatabase(a){try{phishTankDB={urls:a,domains:new Set(a.map(a=>a.domain)),urlMap:new Map(a.map(a=>[a.url.toLowerCase(),a])),domainMap:new Map},a.forEach(a=>{phishTankDB.domainMap.has(a.domain)||phishTankDB.domainMap.set(a.domain,[]),phishTankDB.domainMap.get(a.domain).push(a)}),self.postMessage({action:"databaseLoaded",data:{count:a.length}})}catch(a){self.postMessage({action:"error",data:{message:"Failed to load database",error:a.message}})}}function checkUrl(a){if(!phishTankDB)return{found:!1,error:"Database not loaded"};try{const e=a.toLowerCase().replace(/\/$/,""),s=new URL(a).hostname;if(phishTankDB.urlMap.has(e)){const a=phishTankDB.urlMap.get(e);return{found:!0,verified:a.verified,timestamp:a.timestamp,source:"PhishTank",matchType:"exact"}}if(phishTankDB.domains.has(s)){const a=phishTankDB.domainMap.get(s);return{found:!0,verified:a.some(a=>a.verified),timestamp:a[0].timestamp,source:"PhishTank",matchType:"domain"}}return{found:!1}}catch(a){return{found:!1,error:a.message}}}function checkBatch(a){return a.map(a=>({url:a,result:checkUrl(a)}))}self.addEventListener("message",async a=>{const{action:e,data:s}=a.data;switch(e){case"loadDatabase":await loadDatabase(s.urls);break;case"checkUrl":const a=checkUrl(s.url);self.postMessage({action:"checkResult",data:a});break;case"checkBatch":const e=checkBatch(s.urls);self.postMessage({action:"batchResults",data:e});break;default:self.postMessage({action:"error",data:"Unknown action"})}}),self.postMessage({action:"ready"});