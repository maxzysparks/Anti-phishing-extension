(()=>{let a=null;function e(e){if(!a)return{found:!1,error:"Database not loaded"};try{const s=e.toLowerCase().replace(/\/$/,""),t=new URL(e).hostname;if(a.urlMap.has(s)){const e=a.urlMap.get(s);return{found:!0,verified:e.verified,timestamp:e.timestamp,source:"PhishTank",matchType:"exact"}}if(a.domains.has(t)){const e=a.domainMap.get(t);return{found:!0,verified:e.some(a=>a.verified),timestamp:e[0].timestamp,source:"PhishTank",matchType:"domain"}}return{found:!1}}catch(a){return{found:!1,error:a.message}}}self.addEventListener("message",async s=>{const{action:t,data:o}=s.data;switch(t){case"loadDatabase":await async function(e){try{a={urls:e,domains:new Set(e.map(a=>a.domain)),urlMap:new Map(e.map(a=>[a.url.toLowerCase(),a])),domainMap:new Map},e.forEach(e=>{a.domainMap.has(e.domain)||a.domainMap.set(e.domain,[]),a.domainMap.get(e.domain).push(e)}),self.postMessage({action:"databaseLoaded",data:{count:e.length}})}catch(a){self.postMessage({action:"error",data:{message:"Failed to load database",error:a.message}})}}(o.urls);break;case"checkUrl":const s=e(o.url);self.postMessage({action:"checkResult",data:s});break;case"checkBatch":const t=o.urls.map(a=>({url:a,result:e(a)}));self.postMessage({action:"batchResults",data:t});break;default:self.postMessage({action:"error",data:"Unknown action"})}}),self.postMessage({action:"ready"})})();